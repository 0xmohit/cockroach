# LogicTest: 5node-dist

statement ok
CREATE TABLE t (k INT PRIMARY KEY, v INT, w INT, INDEX v(v))

# Prevent the merge queue from immediately discarding our splits.
statement ok
SET CLUSTER SETTING kv.range_merge.queue_enabled = false;

# Split the index into 5 parts, as if numbers were in the range 1 to 100.
statement ok
ALTER INDEX t@v SPLIT AT SELECT (i * 10)::int FROM generate_series(1, 4) AS g(i)

# Relocate the five parts to the five nodes.
statement ok
ALTER INDEX t@v EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i+1], (i * 10)::int FROM generate_series(0, 4) AS g(i)

query TTTI colnames
SELECT start_key, end_key, replicas, lease_holder from [SHOW EXPERIMENTAL_RANGES FROM INDEX t@v]
----
start_key  end_key  replicas  lease_holder
NULL       /10      {1}       1
/10        /20      {2}       2
/20        /30      {3}       3
/30        /40      {4}       4
/40        NULL     {5}       5

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT * FROM t WHERE v > 10 AND v < 50]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyslF1r2zAUhu_3K8S5aoeM9WGnma9SVo9lZEmXBDbofOHZh2JwLU-Sy0bJfx-2w-aUVYlpLiW973n03JwnMD9LiGATL-L3W9LoknxYrz6Tu_jb7eJ6viQXN_PNdvNlcUn2kbd9wJKvH-N1TC4eyfeGMYmEs0tyvbz5e5ORkF0mQKFSOS7TBzQQ3QEHCgIoSKAQAIUQEgq1Vhkao3QbeeoK8_wXRIxCUdWN7a9tYUuECJpK6Rw15kAhR5sWZfue7BIKmdII0b_oUnmq9qfPghRUY_djEwrGpvcIkdzRAZoP0P8ZvE1_lLjGNEfts4Px8DizQGFTp5WJiM-554s2sWpsRGYcXsLzMfhPqqj29OCQXuviIdW_uz_skXQm6Ey-CBYHYHG6N3d5C-b5crz3EfzAOzyvtzzdW7i8JfP8YLz3EfzAe3Je7-B0b-nyDpjnh-O9j-AH3lfn9WZu8BpNrSqDJ20O1q4ezO-x31NGNTrDW62yDtMfV12vu8jR2P71XX-YV_1T-8FhmTvLwl0WzjI7KPPnZeksB25y8Bpy6CxP3OTJa8hXzvLUTZ6OIie7N38CAAD__4o4Yts=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT * FROM t WHERE v > 10 AND v < 50 ORDER BY v]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyslEFv0zAUx-98CuudVnAV20m7klMGDaKotCOtBGjkEJKnKVIWB9upQFO_O2pSsQRtbtf1aPv9_fv_Lu8e9K8CfFiF8_D9mtSqIB-i5WdyE367nl_NFuRiOlutV1_mA7Ifed0OGPL1YxiF5GJDftSMuUg4G5CrxfTfTUpGbECW0TSMyLvvZBMDhVJmuEjuUIN_AxwoCKDgAgUPKIwgplApmaLWUu1G7pvALPsNPqOQl1Vt2muTmwLBB6kyVJgBhQxNkhfNv4F4A_E2ppBKheA_TC_kUFbOpDcdbynI2ux_jilok9wi-O6Wdui8Q3_k43Xys8AIkwyVw_plNoEBCqsqKbVPHM6HjthNLGvjk4DTQMBTDfhzGnySebkv4PULVCq_S9SfpsYDlQbuk2DRA4vj1blNXbCh456kfqBBR310XnX3eHVhU3fZ0PFOUj_QoKM-Pq-6d7y6a1P32NAZnaR-oEFH_fK86swOjlBXstR41BZhuzWE2S22a0vLWqV4rWTaYNrjssk1Fxlq076-bQ-zsn3aFeyGuTUs7GFhDbNemP8fdq1hz072XkIeWcNjO3n8EvKlNTyxkyfPIsfbV38DAAD__zn-aD4=

# Here we care about ordering by v, but v is not otherwise used.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT w FROM t WHERE v > 10 AND v < 50 ORDER BY v]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyslFFv0zwUhu-_X2Gdq1Wfo9hO0pVcddAgiko70kqARi5CcjRFyuJgOwU09b-jJhUkCNyu66Xt8_p5n5vzCPprCSGso0X0akMaVZLX8eoduYs-3i5u5ktyNZuvN-v3ixE5jHzrBgz58CaKI3K1JZ8bxjwknI3IzXL26yYjARuRVTyLYvLyE9kmQKGSOS7TB9QQ3gEHCgIoeEDBBwoBJBRqJTPUWqr9yGMbmOffIWQUiqpuTHdtClMihCBVjgpzoJCjSYuy_Xcq_odkl1DIpEIIf08vpSNrdzKYTnYUZGMOPycUtEnvEUJvR3t03qP_5eNN-qXEGNMclcuGZbZTAxTWdVrpkLicO67YT6waE5Ipp1MB_2rAn9LgrSyqQwF_WKBWxUOqfrQ1Oqpno4oBVZzuzW3egjmud5b3kQY97-CC3t7p3sLm7THH9c_yPtKg5z2-oLd_urdn8_aZ4wZneR9p0PO-vqA3s1Nj1LWsNJ60Odh-9WB-j92q0rJRGd4qmbWY7rhqc-1Fjtp0ry-6w7zqnvYF-2FuDQt7WFjDbBDmf4Y9a9i3k_3nkANreGwnj59DvraGJ3by5EnkZPffzwAAAP__vMZmFw==

# The single join reader should be on node 5, and doesn't need to output v.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT w FROM t WHERE v > 40 AND v < 50 ORDER BY v]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyUkcGOmzAQhu99itGcEskRBpKLT0kbqlKlkEKktko5UBhFSART26RdRbz7Coh2k5XC7h79-__ms8Zn1H9LFBh7G-_TDhpVwuco_AZ77-d2s_IDmKz9eBd_30zhUvk3FAz8-OJFHkxO8Lvh3CWY8ymsgvVTksGCTyGM1l4EH3_BKUGGlcwpSI-kUezRRoYLTBjWSmaktVRdfO5Lfv4fBWdYVHVjujhhmElFKM5oClMSCgzkTNaWgwxzMmlR9rWWoWzMM6RNeiAUbsuuBtvjg3fpn5IiSnNSFr8Zj6elQYZxnVZagDW3Z9aia4SNEbC08Z7efo_-qyyqi92-tdeqOKbqoX_DoHTvKp0b5SurjEjXstL0pl3yNmFI-YGG79KyURltlcx6zXAMe64PctJmuHWHg18NV90Dr2F7FHbGYWcU5i_gpP3wGAAA___-4PGJ
