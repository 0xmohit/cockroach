# LogicTest: 5node-dist

statement ok
CREATE TABLE data (a INT, b INT, c FLOAT, d DECIMAL, PRIMARY KEY (a, b, c, d))

# Prevent the merge queue from immediately discarding our splits.
statement ok
SET CLUSTER SETTING kv.range_merge.queue_enabled = false;

# Split into ten parts.
statement ok
ALTER TABLE data SPLIT AT SELECT i FROM generate_series(1, 9) AS g(i)

# Relocate the ten parts to the five nodes.
statement ok
ALTER TABLE data EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i)

# Verify data placement.
query TTTI colnames
SELECT start_key, end_key, replicas, lease_holder FROM [SHOW EXPERIMENTAL_RANGES FROM TABLE data]
----
start_key  end_key  replicas  lease_holder
NULL       /1       {1}       1
/1         /2       {2}       2
/2         /3       {3}       3
/3         /4       {4}       4
/4         /5       {5}       5
/5         /6       {1}       1
/6         /7       {2}       2
/7         /8       {3}       3
/8         /9       {4}       4
/9         NULL     {5}       5

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER () FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJys08-K2zAQBvB7n0J8pwRkHNlODzqltCkEspttnP6BxQc1GrYGR3IlmbaEvHuJXdhmyRYV71HSfJ4fw_gI_72BRLlcL9_uWOca9n67uWH3yy936zerWzZ5typ35Yf1lP0p8d1hoqZs82m5ZZPpUK1VUBU4jNV0qw7kIe8hwJGBIwdHAY45Ko7W2T15b9255NgHVvon5IyjNm0XztcVx946gjwi1KEhSOzU14a2pDS5dAYOTUHVTd-mdfVBuV-LswEcZauMlyxJBVNGM8Fs-EYOHJsuSLYQqE4ctguPvXxQDwQpTvwZzyOjM9ZpcqQvCNXpivhzbbT9QS6dX3LLjzeThZg-y8guGCJ-LCJmLKlI0mzUYLJ4URYlypI0HyXK40V5lChP0mKUqIgXFVGiIknnL7bOV0Rb8q01np6s9fUvz87rTvqBhn_D287t6c7Zfd9mOG76XH-hyYfhVQyHlemfeuDfYfHP8OuL8OxpOBvTOR8TLsaE5_8Vrk6vfgcAAP__lvjUlg==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER (PARTITION BY b ORDER BY c) FROM data]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzElV2PmkwYhs_fXzF5jjTvEBjAXZcjtl2bkLhi0X5lw8HoTFYTZegMpN0Y_3sDmrra7QwJhp6JzPV8XHfC7EB930AAs9F49H6OSrlBH5L4ET2Nvk7H99EE9R6i2Xz2cdxHxyOq3PZoH8WfRwnqTe-TeTSP4gl69w0tUJw8jJLq57J_KMNoQVPAkAnGJ3TLFQRPQACDCxg8wOADhgGkGHIpllwpIasjuxqI2E8IHAzrLC-L6u8Uw1JIDsEOinWx4RDAnC42POGUcWk7gIHxgq43dZtcrrdUvoTVDIBhltNMBciyCaIZQwSJYsUlYIjLIkAhwaGLQw_SPQZRFseOp0aLF7SianXeInQh3acYVEGfOQRkj_8y-alOmQnJuOTsrFJd5XK3L-uMiR9c2oPzrq-lByisVM4-PfZC0ke93wmE3v_903IXa51Gdq878kRYIreJc3Hy7d7eWW_SPGjSJGibWLbbUdTkalHfdBW121y320i3a9leR7rdq-m-7Uq311y310i3Z9l-R7q9q-kedqXbb67bb6Tbt-xBR7r9q-m--xf3xhsDJVzlIlO80a3gVCtx9swP-ytRyiWfSrGs2xwe45qrv7uMq-Lw9vgQZYdX1YDNYb8NfNMGHraBiaOnySXtvKZdPexqYXLu27mkvTZh6WFDWHrYEJYeNoRl2NkQlt8mrEEb3XrYoFsPG3TrYYNuw84G3TdtdN-20a2HDbr1sEG3HjboNuxs0D1so_uujW49bNCthw269bBBt2Fn05f_j4tD6zvd__crAAD__0BBMIk=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER (PARTITION BY b ORDER BY c) FROM data ORDER BY d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJy8ll9vmzAUxd_3Kaz7lKiOiA30D090ayZFapOOZP9U5YEGq42U4syAtqrqd58gzVJo6uvJiLcGOD6H87u69AmyX2sIYDa6HH2ak0KtyedoekVuRj-uL8_HE9K7GM_msy-XffLySFY89OI-mX4bRaR3fR7Nx_PxdEI-_iS3ZBpdjKLyz2V_e0wS5_H-arIACqlMxCR-EBkEN8CAAgcKLlDwgIIPCwobJZciy6QqH3mqBOPkDwRDCqt0U-Tl5QWFpVQCgifIV_laQADz-HYtIhEnQjlDoJCIPF6tK5uNWj3E6jEs4wCF2SZOs4AMHEbiNCGMyPxeKKAwLfKAhIyGHg05DV1YPFOQRf5iuve6fST3cXZfd6meX1DI8vhOQMCe6Tvh9-cUqVSJUCKpnVSd0ny976s0kb-Fcvy662sEAQnLJmdfr3oh65Pev-ZD76j_-v144832qfm7qQ9kmkmVC-WwRt0hPzIzcw0qOlRQ5XCwpYkcyI3D_Eafh-29mj0zHy9mMl4OGzi8uwFjrQ3YcYcDhpS-GzDWyoBxc8LciDAfOG53hHlrhE86JIyUviPMWyHsmhN2jQi7A8frjrDbGuHTDgkjpe8Iu60Q9swJe0aEvYHjd0fYa43wWYeEkdJ3hL3W_w04YBaJbCPTTBh94YdlhSK5E9u-M1mopbhWclnZbH9OK131KUpElm_vvvwYp9tbZUBzsW8jPrURM6vczNOrWVM9fK3mNfGwKeZasat3drVidqy39mxQ68UIar0YQY3EtsqNofa1hSN9H9ugPrGBpRcjsPRiBBYS2yo3ButU2_eZHtaZDSxmtUURNYILUSO8sOR20dFNql-lDNmlzGqZsjfb9L-g6dUYNL0ag4Ykt4uOQnuzUuvQfASafqc2oS2eP_wNAAD__49mTNk=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER (PARTITION BY b ORDER BY c), avg(a) OVER (PARTITION BY b) FROM data ORDER BY d]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzEll9v2jAUxd_3Kaz7RFSj4PzpnzylW9mE1EIXWLepyoNLrBaJxsxJtlUV331KKKNQ8M3kDKQ-NE1OzvH5Xd3mGbIfUwhg2L3sfhiRQk3Jx2hwRW67364vz3t90rroDUfDz5cWeXkkKx5b3CKDm25EWtfn0ag36g365P13ckcG0UU3Kn8dW5Twn_e7HrQWJgnP-UqTxEAhlYno80eRQXALDCg4QMEFCh5Q8CGmMFNyLLJMqvKR50rQS35D0KEwSWdFXv45pjCWSkDwDPkknwoIYMTvpiISPBHK7gCFROR8Mq1sZmryyNVTWMYBCsMZT7OAtG1GeJoQRmT-IBRQGBR5QEJGyx-Phg4NXYjnFGSRv_iu7O6eyAPPHtaNQg_ieUwhy_m9gIDN6Y78q_cUqVSJUCJZe1P1ls0Tfp2kifwllO2vu76uPiBhWeTwy1UrZBZp_S0_9I8soHB-86kVOtbrw2455uoIzs4jbAk4lCoXymYb9YfuUW0_t0Zl2wqrTLa21pdtObOZv9HvdntvzZ7VnzhWZ-Js1radvc4ca2zmjg81cwiE5cyxpmbOqQ_dqQXdadvuXqE7jUE_ORR0BMISutMUdLc-dLcWdLdte3uF7jYG_fRQ0BEIS-huU9C9-tC9WtC9tu3vFbrXGPSzQ0FHICyhe__jk2KLXySymUwzUetroVNWKpJ7seg_k4Uai2slx5XN4nJQ6ap_Y4nI8sXdl4teurhVBqwv9k3EpyZiZpSbeXo121R3XqudNXFnU-xoxa7e2dWK2bHe2jNBrRcjqPViBDUS2yg3htrXFo70fWyC-sQEll6MwNKLEVhIbKPcGKxTbd9nelhnJrCY0RZF1AguRI3wwpKbRUc3qX6VMmSXMqNlyt5s03-Cpldj0PRqDBqS3Cw6Cu3NSl2H5iPQ9Dt1E1o8f_cnAAD__8KMaIo=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER w1 AS sum_a, avg(b) OVER w2 FROM data WINDOW w1 AS (PARTITION BY b ORDER BY c), w2 AS (PARTITION BY a, d) ORDER BY sum_a ]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMlt9v2j4QwN-_f4V1T6AaJXbCrzyF78ompBY6YO2mCk2GWC0STVgS1lUV__uUAKMh1BeagJB4AOKPz3f-nC6vEPyagQWD9lX705As_Bn53O9dk_v295urVqdLSpedwXDw9apM1kuCxVNJlEnvtt0nz4y0BtE_PwUl4vdDabx5wFfbOCIU5K7TvezdrReXblr9YWfY6XXJ_z_ImPT6l-1-9HVSphGWWiIoccrbZXGwEVBwPUd2xZMMwLoHBhQ4UDCAggkUqjCiMPe9iQwCz4-WvMZAx_kDlk5h6s4XYfT3iMLE8yVYrxBOw5kEC4ZiPJN9KRzpazpQcGQoprM4zNyfPgn_xY7SAgqDuXADi1Q0RoTrEEa88FH6QKG3CC1iM2rz-GPQ6LsJoyUFbxGuQ28jjl_Iowgek7FsA0bLEYUgFA8SLLak76Sw3Wfher4jfekkdop32U3ybuo63rP0tWoy6tvSW8SO6jn4dl2yWZmU_t2BbV6UD0ymSu1aIh9-pHyYrkwoPgeF1u2Xks3LiavayWh7VOPdo-45yMDzw-gYO3W12cW7-5sZSrGvEOtN9xyi61W8ucb1nbrtD19NhGfZm4NlaQ6NVTR-6vZghelUO4v2KC4fxo7cHog_m_aofbQ9eHY_eSY_eUUzTu0nL-w-62fhZ3H5MH5kPxF_Nn7WP-qnkd1PI5OfRkUzT-2nUdh9Ns7Cz-LyYcaR_UT82fjZ-KifZnY_zUx-mhWtemo_zcLus3kWfhaXDzOP7Cfiz8bPZhGvv3v278tg7rmBzPRmq0elks6DXNU18Bb-RN743iQOs_rZi7n4vcWRQbh6uv7RcVePogNmh2t5YKbnos1cdENNMyXN88D1PDBDrguhq7nopprmu7T-ljYSsL4LG0oYuWtTCXOmDl3N0x9qGOkPJDLSHwiN1Ayhkf6o5ekPNYz0hxrG-gOhkf5AaKQ_6kpLG2pJG3n6o5nHcDWMGI5ERgxH6HxZYxNAPUCwEaCmsRmADC9sCCA4NgUQHNGcpaZIQlXG1aIz9RhB7pyl5sghqiM04joWG5Edw3NmjumemqEH6a6mMd3VNKo7gmO6Izime2qQJnWvIbqnZspBuqdmykG6q2lMdyQ2pjuC58wc0z01Tw_SXU1juqtpVHcEx3RHcEz31FRNvmvrat15arYodR8t__sbAAD__3_NmbA=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) OVER w1 AS sum_a, avg(b) OVER w2, rank() OVER w1 AS rnk, row_number() OVER w3 AS rnumber, max(a) OVER w3, min(b) OVER w2 FROM data WINDOW w1 AS (PARTITION BY b ORDER BY c), w2 AS (PARTITION BY a, d), w3 AS (PARTITION BY a, c ORDER BY b, d) ORDER BY rnk, rnumber ]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzMmF9v2kgUxd_3U4zuk6MMMjO2SeDJdMOu0AbIGtp0VaHI4FGCCjZrm02rKN99ZQPlT8hcp9dV_BIFj39z5np8zlx4guTfObRg2Lnu_D5iq3jO_vAGPfal8_nmut3tM-OqOxwN_74-Y5tbktXC8M_Y4FPHY4-CtYfZlTufM_-_e2OyHZCcxX741Ti4MQ6_chZHj3fhajFR8Y9Baz2YX-Rs4X_bCVicLWbh3rzr5QV-6rPbbv9qcLuZ27hpe6PuqDvosw__sAkbeFcdL_t3esYz7MUtPmdBNmSdHJruJphkN-4-rotYL3YMHMIoUH1_oRJofQEBHCRwsICDDRwcGHNYxtFUJUkUZ7c85UA3-AatOodZuFyl2eUxh2kUK2g9QTpL5wpaMPInc-UpP1CxWQcOgUr92TyXWcazhR9_d7PHAByGSz9MWqxmCuaHARMsSh9UDBwGq7TFXMFdyTd_JXet_H8bxs8colW6WcBOd_KdPfjJw6Gi68D4ecwhSf17BS3xzF8pZDfPKoziQMUqOJgpn-W41NtZGESPKjadQ9X9XWkxNxsdfuwZrjhjxo8NcRvnZ8DBa_f_Ml5cf1uRl9xtHtQpf1Gdoq4tNF8Hh_anPw1XZsX1un3DdX6inIuDcqxfVY5-3_J1cPAGt3f9j70PHe94n7jbzPew1_5suPYrg_svs8Vdm7sOdxtHj2RXq_1qrScqGUZxqmJTHm2La51z1z5_VcMp8DxPPc29iU8sph_VoqUpnaMNOL2ExsESRPFIEUUixRQ1U75PqIjS3s5GpUOlvDqFqEColFiOft8qECqI27ahIiihIos7WhZytKyZ1vs4Wpb2alxU2tHl1SlkBRxdYjn6fauAoxG3bR0tKY62ijvaKuRoq2ba7-Noq7RX47LSji6vTmFVwNEllqPftwo4GnHb1tEWxdF2cUfbhRxt10znfRxtl_ZqNCvt6PLqFHYFHF1iOfp9q4CjEbdtHW2X9VX-hIankmUUJqrQN_R69rxVcK_Wm5NEq3iqbuJomsusPw5yLv9GEagkXY9uPnTD9VC2wOLwBQUWkkSTtCWiLfQ0Bb6kwMIi0SRtiWhLLU2CmxRY2CSapC0RbeuYru_Th3D9GLa1sKNXdrSwbOilG5RM0cOIrxFlxJoITdLGMuWCkil6GPG1HsYyBaFJ2limXFIyRQ8jvtbDWKYgNEkby5Sm1tmirne2eHFwviVVBHIAkWjEnZg2dmojOE0dbTiQc4REY8c-cgJiPQeC09SxhBAvjtC3RARCIz5FaCwkMJymjsWE0LcPwkFyQt9AYDlBaiAQGnMqrYXAcJo6mhOkLgKhMafS-ggMp6mjOUFqJRAacyqtmcBwmjqaE_p-QiL9hCT1E5LUTyA04lRMG_EahtPUsZyQpH4CoRGnIjSWExhOU0d_xSD1EwiN_ZZA6ycwnKaO5YTU9xMS6Sfk2_qJ8fNv_wcAAP__iEF9iQ==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT min(d) OVER w1, sum(a) OVER w2, avg(b) OVER w3 FROM data WINDOW w1 AS (PARTITION BY b ORDER BY c), w2 AS (ORDER BY c), w3 AS (PARTITION BY a, d) ORDER BY a, b ]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJzElUFv4jgUx-_7Kax3CqpRsBMozcnsll1FaqELTDujioMhVosECeMkw1QV332UUKYlLX6pAsMFEfDP7--fn51niL_PwYNh96r7z4ikek7-HfSvyX33681Vx-8R69Ifjob_X9XIy5DFLLSCGunfdgdkxSiJ04Ult8-cEvnjwZpsn53NbIFMJLnze5f9O7JipDMk1k1nMPJHfr9H_v5GJqQ_uOwOsq_TGiUrng_Z_c15j0lKsiTbYZKSyRgohFGgenKhYvDugQEFDhQcoOAChSaMKSx1NFVxHOlsyHMO-MFP8BoUZuEyTbKfxxSmkVbgPUMyS-YKPBjJyVwNlAyUthtAIVCJnM3zMks9W0j9JLKVAoXhUoaxR-o2IzIMCCNR8qg0UOiniUeESwWjgm8_ORVO_t2F8ZpClCYvGV5LT57Io4wfd4uKFozXYwpxIh8UeGxN96zldZ40jHSgtAp2ZspnKa72bhYG0Uppu7lb9e0WeES0gMK137MEq73ZMnF-Viss5jUoP1JQVtiU4ZdrS_DSsZy9sYxFmVFPm4oLoNC5_c8STu13B7DtrrtUNPcmcj-TaBjpJMvDC03inlHRPCtW3luzuVOTlT8RrMyJsFnd5ic7E-xgrdY67png5bXzUtp53XZOpp0fTPv5cbU75bU7pbQ7dds9mXbnYNrbx9XultfultLu1u3mybS7B9N-8edevB_EGKh4GYWxKgT-eOZGthAVPKjNquMo1VN1o6NpXmbz2M-5_BYOVJxs_n158MPNX1nA8nCrCtyuArNGJZqbaVakG29pBOZG2NmBG0XYMcKuGXaNMENKN6v0iRlG-sQMI32CxEb6BKGRrW5V6ZPzKr7NMOLbDCO-kdiIb4RGlLWr-L6o4tsMI77NMOIbiY34RmjsHnx3jX5GOHt3jX7GOEIjyhEacY4lR6RjOObN_AYp0uP1X78CAAD__6lo0uA=
