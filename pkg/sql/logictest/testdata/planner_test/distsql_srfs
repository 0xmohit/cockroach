# LogicTest: 5node-dist

statement ok
CREATE TABLE data (a INT PRIMARY KEY)

# Prevent the merge queue from immediately discarding our splits.
statement ok
SET CLUSTER SETTING kv.range_merge.queue_enabled = false;

# Split into ten parts.
statement ok
ALTER TABLE data SPLIT AT SELECT i FROM generate_series(1, 9) AS g(i)

# Relocate the ten parts to the five nodes.
statement ok
ALTER TABLE data TESTING_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i)

statement ok
INSERT INTO data SELECT generate_series(0, 9)

# Correlated SRF
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, generate_series(a, a + 1) FROM data ORDER BY 1, 2]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJykk8GK2zAQhu99imFOG6LgSHa2Rae03RQCaZLGObQspqjWkHVxLFdSoCXk3YvtwtbbOLjJUdJ8-j9mmCO6HzlKjGeL2fstHGwOHzarj_A4-7xevJ0v4e5hHm_jT4sB_ClRDHZUkFWevjqyGbk7xUDBEPigYbXyClabh9kG3n0BzkAkyLAwmpZqTw7lI3JkKJBhiAwjZDjBhGFpTUrOGVuVHGtgrn-iHDPMivLgq-uEYWosoTyiz3xOKHGrvuW0IaXJBmNkqMmrLK9jSpvtlf01rYyQYVyqwkkYBRxUoYGD8U9kMTkxNAf_nOC82hFKfmIdFs_hxmqypNuxUz7E5HRGdW3Nd0p9TD6YtJGXLZ1yBlNeNVVKOV9u3ww6NUWn5hmD2FhPNrj_R5hNxRAZ7pVPnyCnQgLvTAxbibz_eHif8QR8FIgrBiT6e4heHmIUhFd4hP09wl4e4SiIrvCI-ntEvTyiUTC5cXHOeGzIlaZw1FLo-nlcbRXpHTVb6MzBprS2Jq1jmuOq5uoLTc43r7w5zIv6qRb8G-YXYdGCxy9hcRF-fRkOb9GOboEnt8D3_wUnp1e_AwAA__-WzxHo

# Order by primary key
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, generate_series(a, a + 1) FROM data ORDER BY 1]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJykk8GK2zAQhu99imFOG1bGke2UolPabgqGNEntHFoWU1RrSF28lisp0BLy7sV2YetlU7TxUdJ8_j9-xie0P2sUmK_Wq_d7OJoaPmTbj3C_-rxbv003cHOX5vv803oGf0ckgwM1ZKSjr5ZMRfZGMpBwC3w2sEo6CdvsbpXBuy_AC2TYaEUb-UAWxT1yZBghwxgZJshwgQXD1uiSrNWmGzn1QKp-oZgzrJr26LrrgmGpDaE4oatcTShwL7_VlJFUZMI5MlTkZFX3Ma2pHqT5vex0kGHeysYKCEIOslHAQbvvZLA4M9RH95hgnTwQCn5mFywew7VRZEiNY5f8FovzM6o7o39Q6XJy4WKMPO1zyRksedeoECLd7N_MLmpGI03uXxb3KSvkQRhdUVfk7xF5eURBGF_hEft7xF4ecRAmV3gk_h6Jl0cShIuJa_yMR0a21Y2lkcKlL8-7HSd1oOGfsPpoStoZXfYxw3Hbc_2FIuuGVz4c0qZ_6gX_hfl_4dcjeP4UjqYkx1PgZAq8eBFcnF_9CQAA___wntkj

# Order by SRF
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, generate_series(a, a + 1) FROM data ORDER BY 2]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJykk8-K2zAQh-99CjGnDSujSHa2Rae03RQMaZLaObQspqjWkLp4LVeSoSXk3YvtwtYhCW5y1J9vfh8zzB7czxIkpIvl4v2WNLYkH5L1R_K0-LxZvo1X5O4xTrfpp-WE_P2iKNlhhVZ5_OrQFujuFCWK3BM-6VmtvCLr5HGRkHdfiMiAQmU0rtQzOpBPwIGCAAohUIiAwgwyCrU1OTpnbPtl3wGx_gVySqGo6sa31xmF3FgEuQdf-BJBwlZ9KzFBpdGyKVDQ6FVRdjG1LZ6V_T1vdYBCWqvKSRIwTlSlCSfGf0cL2YGCafxLgvNqhyD5gZ6xeAlvKmM1WtSD4OxwwnNjzQ_MfYqezYaax82cc0rmvG2nlDJebd9MzjqKs44nDFJjPVr2MEyfi_uz5cNBeT5-EHzMIBgPmLhiFGK8hxjlIQIWXuERjvcIR3mEAYuu8IjGe0SjPKKAzW5ckRMeCbraVA6PVuV05Wm7Qqh32O-bM43NcWNN3sX0x3XHdRcane9feX-Iq-6pE_wX5hdhMYCnx7C4CL--DIe3aEe3wLNb4If_grPDqz8BAAD__8JdDD8=

# Filter on ProjectSet node
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, b FROM (SELECT a, generate_series(1, 3) AS b FROM data) WHERE a < 4 AND b = 3]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJykk9Fr2zAQxt_3Vxz3ZIOCLcsZQzBoWFMWyNIsDmzQmaFYR-bhWpkkw0bI_z5it83SpcNL3qy7-_z99KHbovtRocRsPB2_W0JjK7hZ3H6Au_Hn-XQ0mUFwPcmW2cdpCA8jisGqmwkOlTXVZJWnr45sSS7gDEQIo-xxVCuvQvj0frwYQ6DgSxPHooA0hNHsGoIVvAUR5siwNppm6p4cyjvkyDBBhgIZpshwiDnDjTUFOWfsfmTbCib6J8qYYVlvGr8v5wwLYwnlFn3pK0KJS7WqaEFKk41iZKjJq7JqbTa2vFf219WeERlmG1U7CYOIg6o1cDD-G1nMdwxN4w8Ozqs1oeQ79gLFwbypjdVkSR8Z57sTnHNrvlPhM_LR8Bjzr4illJPZ8g0D8fAVIsObsvJkJQRX_Cnlx3YX9lWyT_tJ8tK9kqN78f7p8j7pRnwQJWfkm_TnSHpxJINInMEh-nOIXhxiEKVncKT9OdJeHOkgGl747k9wLMhtTO3o2fs__ed4vxek19QtkTONLWhuTdHadMfbVtcWNDnfdXl3mNRtqwX8U8z_KX59JI6fi5NLnMUl4vQS8fC_xPnu1e8AAAD__7gg75g=

# Multiple SRFs with different lengths
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, generate_series(1, 2), generate_series(1, 4) FROM data WHERE a < 2 ORDER BY 1, 2, 3]
----
https://cockroachdb.github.io/distsqlplan/decode.html#eJyckkGP0zAQhe_8itFw2apeJXZ6QD4V2CAilbYklQAtETLxqASlcbAdCVT1v6MkK5awTbXsLR7P994bT47oflQoMYtX8esdtLaCN-nmHdzGH7erl8karm6SbJe9X83grkUx2FNNVnn64siW5K44AzE7W17MBjmtvIIPb-M0BgWf2zCMChCwSW_iFF59gk6AQZQjw9poWqsDOZS3yJGhwJxhY01BzhnblY99U6J_ogwZlnXT-q6cMyyMJZRH9KWvCCXu1NeKUlKabBAiQ01elVUv3djyoOyvZZcMGWaNqp2E64BjfmJoWn-v6rzaE0p-YhPO94bGarKkx1ZLPsf8dCbe1prvVPiMfCDGyIOnlFIm690LBuLua4bsQtfiT9fUNGJymjNBM2M92SB6MBdbijlbRnNkeFC--AYV1RKm3zAaufLHb48_ZnsBvw548PwJGzzjnpJrTO1oZDylHHbrJb2n4XdwprUFba0pepvhuOm5vqDJ-eGWD4ek7q_6gH_D_CIsRnD4LywuwovLcPRfsfPTs98BAAD__xyfXpM=
